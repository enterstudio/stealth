{
  "variables": {
    "package": null,
    "path": null,
    "nodeVersion": null
  },
  "builders": [{
    "type": "docker",
    "image": "ubuntu",
    "export_path": "{{user `package`}}.tar"
  }],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "mkdir /mnt/{{user `package`}}",
        "cd /mnt",
        "wget https://nodejs.org/dist/v{{user `nodeVersion`}}/node-v{{user `nodeVersion`}}-linux-x64.tar.xz -O node.tar.xz",
        "tar -xJf node.tar.xz",
        "echo PATH=/mnt/node-v{{user `nodeVersion`}}-linux-x64/bin:/mnt/{{user `package`}}/node_modules/.bin:$PATH >> ~/.bashrc"
      ]
    },
    {
      "type": "file",
      "source": "{{user `path`}}",
      "destination": "/mnt/{{user `package`}}"
    },
    {
      "type": "shell",
      "inline": [
        "cd /mnt/{{user `package`}}",
        "rm -rf node_modules",
        "npm install"
      ]
    }
  ]
}
